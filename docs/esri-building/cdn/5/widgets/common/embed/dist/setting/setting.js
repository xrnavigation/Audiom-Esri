System.register(["jimu-core/emotion","jimu-core","jimu-for-builder","jimu-ui/advanced/setting-components","jimu-ui","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/dynamic-url-editor"],function(e,t){var s={},a={},i={},o={},r={},n={},l={};return{setters:[function(e){s.jsx=e.jsx,s.jsxs=e.jsxs},function(e){a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.React=e.React,a.classNames=e.classNames,a.css=e.css,a.esri=e.esri,a.expressionUtils=e.expressionUtils,a.getAppStore=e.getAppStore,a.urlUtils=e.urlUtils},function(e){i.builderAppSync=e.builderAppSync,i.helpUtils=e.helpUtils},function(e){o.SettingRow=e.SettingRow,o.SettingSection=e.SettingSection},function(e){r.AdvancedButtonGroup=e.AdvancedButtonGroup,r.Button=e.Button,r.Label=e.Label,r.NumericInput=e.NumericInput,r.Switch=e.Switch,r.TextArea=e.TextArea,r.TextInput=e.TextInput,r.Tooltip=e.Tooltip,r.defaultMessages=e.defaultMessages,r.richTextUtils=e.richTextUtils},function(e){n.DataSourceSelector=e.DataSourceSelector},function(e){l.DynamicUrlEditor=e.DynamicUrlEditor}],execute:function(){e((()=>{var e={4108:e=>{"use strict";e.exports=i},13089:e=>{"use strict";e.exports=n},14321:e=>{"use strict";e.exports=r},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},67386:e=>{"use strict";e.exports=s},79244:e=>{"use strict";e.exports=a},79298:e=>{"use strict";e.exports=o},91480:e=>{"use strict";e.exports=l}},t={};function c(s){var a=t[s];if(void 0!==a)return a.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,c),i.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var s in t)c.o(t,s)&&!c.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var d={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(d),c.d(d,{__set_webpack_public_path__:()=>M,default:()=>T});var e=c(67386),t=c(79244),s=c(4108),a=c(79298),i=c(14321);const o={_widgetLabel:"Embed",websiteAddress:"Website address",code:"Code",codePlaceholder:"Paste the HTML code you want to embed.",embedBy:"Embed by",attributeHint:"URL from an attribute",expressionHint:"URL by an expression",blankMessage:"Blank message",blankMessageHint:"Show this message if the URL resolves to blank values.",autoRefresh:"Auto refresh",autoInterval:"Interval",autoUnit:"Minute",reloadSetting:"Do not reload iframe when URL changes",maxLimit:"Maximum character limit exceeded.",moreDetailsOnHTML:"Check more details on the supported HTML formats {detailsFormatLinkTag}here{detailsFormatLinkTag}.",honorThemeFont:"Honor theme font",honorThemeFontTips:"This option only applies to HTML text with no src nor font-family style configured."};var r;!function(e){e.Url="url",e.Code="code"}(r||(r={}));var n=c(13089),l=c(91480),h=c(28996),p=c.n(h),u=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const g=s=>{const a=window.SVG,{className:i}=s,o=u(s,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",i);return a?(0,e.jsx)(a,Object.assign({className:r,src:p()},o)):(0,e.jsx)("svg",Object.assign({className:r},o))};var m=c(45508),b=c.n(m),x=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)t.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(s[a[i]]=e[a[i]])}return s};const f=s=>{const a=window.SVG,{className:i}=s,o=x(s,["className"]),r=(0,t.classNames)("jimu-icon jimu-icon-component",i);return a?(0,e.jsx)(a,Object.assign({className:r,src:b()},o)):(0,e.jsx)("svg",Object.assign({className:r},o))},S=new(0,t.esri.Sanitizer),w=new t.esri.Sanitizer({whiteList:{},stripIgnoreTag:!0}),v=["Trial","Trial Developer","HUP Online Entitlements","Trial Press","Personal Use","Developer Subscription"],y=["Developer","Trial Developer","Developer Subscription"];class j extends t.React.PureComponent{constructor(e){var a,n;super(e),this.supportedDsTypes=(0,t.Immutable)([t.DataSourceTypes.FeatureLayer,t.DataSourceTypes.SceneLayer,t.DataSourceTypes.OrientedImageryLayer,t.DataSourceTypes.ImageryLayer,t.DataSourceTypes.BuildingComponentSubLayer,t.DataSourceTypes.SubtypeGroupLayer,t.DataSourceTypes.SubtypeSublayer]),this.embedTypeChange=e=>{const{config:t}=this.props;e===r.Url&&this.setState({showCodeError:!1}),t.embedType!==e&&this.props.onSettingChange({id:this.props.id,config:t.set("embedType",e).set("honorThemeFont",!1)})},this.checkURL=e=>{if(!e||""===e)return this.setState({urlError:""}),!0;if(!new RegExp("^(([h][t]{2}[p][s])?://)").test(e))return this.setState({urlError:this.formatMessage("httpsUrlMessage")}),!1;if(new RegExp("^(([h][t]{2}[p][s])?://localhost)").test(e))return this.setState({urlError:""}),!0;const t=e.indexOf(".");return t<0||t===e.length-1?(this.setState({urlError:this.formatMessage("invalidUrlMessage")}),!1):(this.setState({urlError:""}),!0)},this.embedCodeChangeRightAway=e=>{const{config:a,id:i}=this.props;if((null==e?void 0:e.length)>8192)return this.setState({showCodeError:!0,codeErrorMessage:"maxLimit"}),void s.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:i,propKey:"codeLimitExceeded",value:!0});s.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:i,propKey:"codeLimitExceeded",value:!1});let o=e;const r=!!o&&!(e=>{let s="";const a=/<iframe\s+[^>]*src=['"]([^'"]+)[^>](.*)/gi,i=/<blockquote [^>]*data-instgrm-permalink=['"]([^'"]+)[^>]*>(.*)<\/blockquote>/gi,o=/<a [^>]*href=['"]([^'"]+)[^>]*>/gi,r=/<blockquote [^>]*data-theme=['"]([^'"]+)[^>]*>(.*)<\/blockquote>/gi,n=/<blockquote [^>]*data-lang=['"]([^'"]+)[^>]*>(.*)<\/blockquote>/gi,l=/<a [^>]*data-theme=['"]([^'"]+)[^>]*>(.*)<\/a>/gi,c=/<a [^>]*data-lang=['"]([^'"]+)[^>]*>(.*)<\/a>/gi,d=["twitter.com","www.twitter.com"];a.test(e)?e.replace(a,(e,t)=>(s=t,e)):i.test(e)?e.replace(i,(e,t)=>{const a=t.substr(0,t.indexOf("?"));return s=`${a}embed`,e}):/<blockquote class="twitter-tweet"(.*)<\/blockquote>/gi.test(e)?e.replace(o,(a,i)=>{const o=t.urlUtils.getUrlHost(i);if(d.includes(o)){const t=i.substring(i.lastIndexOf("/")+1).replace(/[?].*$/,""),a=r.exec(e),o=n.exec(e);let l,c;(null==a?void 0:a.length)>1&&(l=a[1]),(null==o?void 0:o.length)>1&&(c=o[1]),s=`https://platform.twitter.com/embed/Tweet.html?id=${t}${l?`&theme=${l}`:""}${c?`&lang=${c}`:""}`}return a}):/<a class="twitter-timeline" [^>]*href=['"]([^'"]+)[^>]*>(.*)<\/a>/gi.test(e)&&e.replace(o,(a,i)=>{const o=t.urlUtils.getUrlHost(i);if(d.includes(o)){const t=i.substring(i.lastIndexOf("/")+1).replace(/[?].*$/,""),a=l.exec(e),o=c.exec(e);let r,n;(null==a?void 0:a.length)>1&&(r=a[1]),(null==o?void 0:o.length)>1&&(n=o[1]),s=`https://syndication.twitter.com/srv/timeline-profile/screen-name/${t}${r||n?"?":""}${r?`&theme=${r}`:""}${n?`&lang=${n}`:""}`}return a});const h=decodeURI(s).trim().toLocaleLowerCase();return(h.startsWith("javascript:")||h.startsWith("data:")||h.startsWith("vbscript:"))&&(s=""),s})(o);o&&r&&(o=S.sanitize(o)),this.setState({showCodeError:!1}),this.props.onSettingChange({id:i,config:a.set("embedCode",o)})},this.formatMessage=(e,t)=>{const s=Object.assign({},o,i.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:s[e]},t)},this.onDataSourceChange=e=>{e&&this.props.onSettingChange({id:this.props.id,useDataSources:e})},this.onToggleUseDataEnabled=e=>{this.props.onSettingChange({id:this.props.id,useDataSourcesEnabled:e})},this.onSwitchChanged=(e,t)=>{const{config:s,id:a}=this.props;this.props.onSettingChange({id:a,config:s.set(e,t)})},this.onEmptyTipsChange=e=>{const{config:t,id:s}=this.props;this.props.onSettingChange({id:s,config:t.set("blankMessage",e)})},this.handleAutoInterval=e=>{if(null===e)return;const{config:t,id:s}=this.props;this.props.onSettingChange({id:s,config:t.set("autoInterval",e)})},this.labelChange=e=>{var t;const{config:s,id:a}=this.props,i=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;this.props.onSettingChange({id:a,config:s.set("label",i)})},this.webAddressExpressionChange=e=>{const{config:s,onSettingChange:a,id:o,useDataSourcesEnabled:n,useDataSources:l}=this.props,{embedType:c}=s,d=/\<exp((?!\<exp).)+\<\/exp\>/gim,h=null==e?void 0:e.match(/\<urlsearch((?!\<urlsearch).)+\<\/urlsearch\>/gim),p=null==e?void 0:e.match(d),u=w.sanitize(e),g=u&&u.replace(/(^\s*|\s*$)/g,"");void 0===e&&(e=""),(h||p)&&0===g.indexOf("{")||this.checkURL(g)?this.setState({showUrlError:!1}):this.setState({showUrlError:!0});const m=(e=>{let t=[];for(const s in e){const a=e[s],i=null==a?void 0:a.parts;null!=i&&(t=t.concat(i))}return t})(i.richTextUtils.getAllExpressions(e));let b;b=t.expressionUtils.generateFieldsForUseDataSourcesByExpressionParts(m,l);const x=t.expressionUtils.getUseDataSourcesWithoutFields(l);b=t.expressionUtils.mergeUseDataSources(x,b);const f=null==e?void 0:e.match(d),S=c===r.Url&&n&&(null==l?void 0:l.length)>0&&f;e!==s.expression&&a(S?{id:o,config:s.set("expression",e),useDataSources:b}:{id:o,config:s.set("expression",e).set("enableLabel",!1),useDataSources:b})},this.isUsedDataSource=()=>{const{useDataSources:e,useDataSourcesEnabled:t}=this.props;return t&&e&&e.length>0},this.hasExpressionTag=e=>null==e?void 0:e.match(/\<exp((?!\<exp).)+\<\/exp\>/gim);const l=(0,t.getAppStore)().getState();this.accountType=null===(n=null===(a=null==l?void 0:l.portalSelf)||void 0===a?void 0:a.subscriptionInfo)||void 0===n?void 0:n.type,this.state={showUrlError:!1,urlError:"",isExpPopupOpen:!1,showCodeError:!1,codeErrorMessage:"maxLimit",helpUrl:""}}componentDidMount(){const{config:e}=this.props,{embedType:t,expression:a}=e;a||t!==r.Url||this.props.onSettingChange({id:this.props.id,config:this.props.config.set("expression","")}),s.helpUtils.getWidgetHelpLink("embed").then(e=>{this.setState({helpUrl:e})})}componentDidUpdate(){const{config:e}=this.props,{embedType:t,embedCode:s}=e;t===r.Code&&this.textAreaRef&&(this.textAreaRef.value=s||"")}componentWillUnmount(){s.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:this.props.id,propKey:"codeLimitExceeded",value:!1})}render(){const{showUrlError:s,urlError:o,showCodeError:c,helpUrl:d}=this.state,{theme:h,useDataSources:p,config:u,useDataSourcesEnabled:m,id:b,selectWidgets:x}=this.props,{embedType:S,enableLabel:w,label:j,enableBlankMessage:T,blankMessage:M,autoRefresh:C,autoInterval:U,honorThemeFont:E}=u,k=S===r.Url,D=S===r.Code,L=k&&m&&(null==p?void 0:p.length)>0&&this.hasExpressionTag(u.expression),R=v.includes(this.accountType)||y.includes(this.accountType),O=`<a target="_blank" style="text-decoration: none !important;" href=${d}>$1</a>`,N=this.formatMessage("moreDetailsOnHTML",{detailsFormatLinkTag:"<detailsFormatLinkTag>"}).replace(/\<detailsFormatLinkTag\>(.+)\<detailsFormatLinkTag\>/,O),A=(0,e.jsxs)("div",{className:"w-100 d-flex tip-container",children:[(0,e.jsx)(i.Label,{className:"tip-text",for:"embed-honor-theme-font",title:this.formatMessage("honorThemeFont"),children:this.formatMessage("honorThemeFont")}),(0,e.jsx)(i.Tooltip,{title:this.formatMessage("honorThemeFontTips"),showArrow:!0,placement:"bottom",children:(0,e.jsx)(i.Button,{icon:!0,type:"tertiary",className:"d-inline jimu-outline-inside",disableHoverEffect:!0,disableRipple:!0,children:(0,e.jsx)(f,{})})})]}),I=(0,e.jsxs)("div",{className:"w-100 d-flex tip-container",children:[(0,e.jsx)(i.Label,{className:"tip-text",for:"embed-blank-message",title:this.formatMessage("blankMessage"),children:this.formatMessage("blankMessage")}),(0,e.jsx)(i.Tooltip,{title:this.formatMessage("blankMessageHint"),showArrow:!0,placement:"bottom",children:(0,e.jsx)(i.Button,{icon:!0,type:"tertiary",className:"d-inline jimu-outline-inside",disableHoverEffect:!0,disableRipple:!0,children:(0,e.jsx)(f,{})})})]});return(0,e.jsx)("div",{css:(this.props.theme,t.css`
    label {
      cursor: pointer;
    }
    .embed-dynamic-con{
      z-index: 3;
      .ql-editor{
        min-height: 174px;
      }
    }
    .tip-container{
      button{
        border: unset;
        padding: 0px 2px;
      }
    }
  `),children:(0,e.jsx)("div",{className:"widget-iframe jimu-widget",children:(0,e.jsx)("div",{children:(0,e.jsxs)(a.SettingSection,{children:[(0,e.jsx)(a.SettingRow,{label:this.formatMessage("embedBy")}),(0,e.jsx)(a.SettingRow,{children:(0,e.jsxs)(i.AdvancedButtonGroup,{className:"w-100",children:[(0,e.jsx)(i.Button,{className:"w-50","aria-label":`${this.formatMessage("embedBy")} ${this.formatMessage("url")}`,active:k,onClick:()=>{this.embedTypeChange(r.Url)},children:this.formatMessage("url")}),(0,e.jsx)(i.Button,{className:"w-50","aria-label":`${this.formatMessage("embedBy")} ${this.formatMessage("code")}`,active:D,onClick:()=>{this.embedTypeChange(r.Code)},disabled:R,children:this.formatMessage("code")})]})}),k&&(0,e.jsx)(a.SettingRow,{children:(0,e.jsx)("div",{className:"choose-ds w-100",children:(0,e.jsx)(n.DataSourceSelector,{types:this.supportedDsTypes,useDataSources:this.props.useDataSources,useDataSourcesEnabled:m,onToggleUseDataEnabled:this.onToggleUseDataEnabled,onChange:this.onDataSourceChange,widgetId:this.props.id})})}),D&&(0,e.jsx)(a.SettingRow,{children:(0,e.jsx)("div",{className:"body text-paper",css:t.css`
                      color: var(--ref-palette-neutral-1100);
                    `,dangerouslySetInnerHTML:{__html:N}})}),(0,e.jsx)(a.SettingRow,{children:k?(0,e.jsxs)("div",{className:"d-flex flex-column w-100 embed-dynamic-con",children:[(0,e.jsx)(l.DynamicUrlEditor,{widgetId:b,useDataSourcesEnabled:m,useDataSources:p,selectWidgets:x,onChange:this.webAddressExpressionChange,value:u.expression}),s&&(0,e.jsxs)("div",{className:"d-flex w-100 align-items-center justify-content-between",style:{marginTop:"5px"},children:[(0,e.jsx)(g,{color:h.sys.color.error.main}),(0,e.jsx)("div",{style:{width:"calc(100% - 20px)",margin:"0 4px",overflow:"hidden",textOverflow:"ellipsis",color:h.sys.color.error.main},children:o})]})]}):(0,e.jsxs)("div",{className:"d-flex flex-column w-100",children:[(0,e.jsx)(i.TextArea,{height:300,className:"w-100",spellCheck:!1,placeholder:this.formatMessage("codePlaceholder"),defaultValue:u.embedCode||"",onAcceptValue:this.embedCodeChangeRightAway,ref:e=>{this.textAreaRef=e}}),c&&(0,e.jsxs)("div",{className:"d-flex w-100 align-items-center justify-content-between",style:{marginTop:"5px"},children:[(0,e.jsx)(g,{color:h.sys.color.error.main}),(0,e.jsx)("div",{style:{width:"calc(100% - 20px)",margin:"0 4px",overflow:"hidden",textOverflow:"ellipsis",color:h.sys.color.error.main},children:this.formatMessage("maxLimit")})]})]})}),L&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(a.SettingRow,{tag:"label",label:this.formatMessage("label"),children:(0,e.jsx)(i.Switch,{className:"can-x-switch",checked:w||!1,"data-key":"enableLabel",onChange:e=>{this.onSwitchChanged("enableLabel",e.target.checked)},"aria-label":this.formatMessage("label")})}),w&&(0,e.jsx)(a.SettingRow,{children:(0,e.jsx)(i.TextInput,{type:"text",className:"w-100",value:j||"",onChange:this.labelChange})})]}),L&&(0,e.jsxs)(t.React.Fragment,{children:[(0,e.jsx)(a.SettingRow,{tag:"label",label:I,children:(0,e.jsx)(i.Switch,{id:"embed-blank-message",className:"can-x-switch",checked:T||!1,"data-key":"enableBlankMessage",onChange:e=>{this.onSwitchChanged("enableBlankMessage",e.target.checked)},"aria-label":this.formatMessage("label")})}),T&&(0,e.jsx)(a.SettingRow,{children:(0,e.jsx)(i.TextInput,{className:"w-100","aria-label":this.formatMessage("blankMessage"),defaultValue:M||"",onAcceptValue:this.onEmptyTipsChange})})]}),(0,e.jsx)(a.SettingRow,{tag:"label",label:this.formatMessage("autoRefresh"),children:(0,e.jsx)(i.Switch,{className:"can-x-switch",checked:C||!1,"data-key":"autoRefresh",onChange:e=>{this.onSwitchChanged("autoRefresh",e.target.checked)},"aria-label":this.formatMessage("autoRefresh")})}),C&&(0,e.jsx)(a.SettingRow,{flow:"wrap",label:`${this.formatMessage("autoInterval")} (${this.formatMessage("autoUnit")})`,children:(0,e.jsx)(i.NumericInput,{size:"sm",style:{width:"100%"},value:U||1,precision:2,min:.2,max:1440,onChange:this.handleAutoInterval,"aria-label":`${this.formatMessage("autoInterval")} (${this.formatMessage("autoUnit")})`})}),D&&(0,e.jsx)(a.SettingRow,{tag:"label",label:A,children:(0,e.jsx)(i.Switch,{id:"embed-honor-theme-font",className:"can-x-switch",checked:E,"data-key":"honorThemeFont",onChange:e=>{this.onSwitchChanged("honorThemeFont",e.target.checked)},"aria-label":this.formatMessage("honorThemeFont")})})]})})})})}}j.mapExtraStateProps=(e,t)=>{var s,a,i;const o=e&&(null===(a=null===(s=e.appStateInBuilder)||void 0===s?void 0:s.appConfig)||void 0===a?void 0:a.widgets),r=[];if(o)for(const e in o){const s=o[e];"widgets/common/embed/"===s.uri&&s.id!==t.id&&r.push(s)}return{appConfig:null===(i=null==e?void 0:e.appStateInBuilder)||void 0===i?void 0:i.appConfig,selectWidgets:r}};const T=j;function M(e){c.p=e}})(),d})())}}});