System.register(["jimu-core/emotion","jimu-core","jimu-arcgis","jimu-core/react"],function(e,t){var s={},i={},r={},o={};return{setters:[function(e){s.jsx=e.jsx,s.jsxs=e.jsxs},function(e){i.DataSourceManager=e.DataSourceManager},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent,r.MapViewManager=e.MapViewManager},function(e){o.useState=e.useState}],execute:function(){e((()=>{var e={244:e=>{"use strict";e.exports=i},386:e=>{"use strict";e.exports=s},686:e=>{"use strict";e.exports=r},972:e=>{"use strict";e.exports=o}},t={};function n(s){var i=t[s];if(void 0!==i)return i.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="";var a={};return n.p=window.jimuConfig.baseUrl,(()=>{"use strict";n.r(a),n.d(a,{__set_webpack_public_path__:()=>j,default:()=>I});var e,t,s,i=n(386),r=n(244);!function(e){e.Travel="travel",e.Heatmap="heatmap",e.Indoor="indoor"}(e||(e={})),function(e){e.OSM="osm",e.TDEI="TDEI",e.ESRI="esri",e.GeoJSON="geojson"}(t||(t={}));class o{constructor(e){this.source=e.source,this.type=e.type,this.mapType=e.mapType,this.name=e.name,this.url=e.url,this.rules=e.rules,this.additionalParams=e.additionalParams}static fromName(e){return new o({source:e})}static fromGeoJsonUrl(e,s){return new o({source:e,type:t.GeoJSON,name:s})}static fromEsri(e){return new o({source:e.source,type:t.ESRI,url:e.url,name:e.name,mapType:e.mapType,rules:e.rules})}toQueryParams(){const e={};return this.type&&(e[`${this.source}.type`]=this.type),this.mapType&&(e[`${this.source}.mapType`]=this.mapType),this.name&&(e[`${this.source}.name`]=this.name),this.url&&(e[`${this.source}.url`]=this.url),this.rules&&(e[`${this.source}.rules`]=this.rules),this.additionalParams&&Object.entries(this.additionalParams).forEach(([t,s])=>{e[`${this.source}.${t}`]=String(s)}),e}}!function(e){e.Kilometers="km",e.Meters="m",e.Miles="mi",e.Feet="ft"}(s||(s={}));const u={[s.Meters]:1,[s.Kilometers]:1e3,[s.Miles]:1609.34,[s.Feet]:.3048};class l{constructor(e,t){if(e<=0)throw new Error("Step size value must be positive");this.value=e,this.unit=t}static Kilometers(e){return new l(e,s.Kilometers)}static Meters(e){return new l(e,s.Meters)}static Miles(e){return new l(e,s.Miles)}static Feet(e){return new l(e,s.Feet)}static parse(e){const t=e.match(/^(\d+(?:\.\d+)?)(km|m|mi|ft)?$/);if(!t)throw new Error(`Invalid step size format: ${e}`);const i=parseFloat(t[1]),r=t[2]||s.Meters;return new l(i,r)}toString(){return`${this.value}${this.unit}`}convertTo(e){if(this.unit===e)return new l(this.value,this.unit);const t=this.value*u[this.unit];return new l(t/u[e],e)}toMeters(){return this.convertTo(s.Meters)}toKilometers(){return this.convertTo(s.Kilometers)}toMiles(){return this.convertTo(s.Miles)}toFeet(){return this.convertTo(s.Feet)}}class c{constructor(e){this.embedId=e.embedId,this.apiKey=e.apiKey,e.sources&&(this.sources=e.sources.map(e=>"string"==typeof e?o.fromName(e):new o(e))),this.center=e.center,this.latitude=e.latitude,this.longitude=e.longitude,this.zoom=e.zoom,this.soundpack=e.soundpack,this.demo=e.demo,this.title=e.title,this.showVisualMap=e.showVisualMap,this.heading=e.heading,this.showHeading=e.showHeading,e.stepSize&&(this.stepSize="string"==typeof e.stepSize?l.parse(e.stepSize):e.stepSize),this.additionalParams=e.additionalParams}static dynamic(e){return new c(Object.assign(Object.assign({},e),{embedId:"dynamic"}))}static static(e,t,s){return new c(Object.assign({embedId:e,apiKey:t},s))}toQueryParams(){const e={};if(e.apiKey=this.apiKey,this.sources&&this.sources.length>0){const t=this.sources.map(e=>e.source).join(",");e["sources"]=t,this.sources.forEach(t=>{const s=t.toQueryParams();Object.assign(e,s)})}return this.center?e.center=`${this.center[0]},${this.center[1]}`:(void 0!==this.latitude&&(e.latitude=String(this.latitude)),void 0!==this.longitude&&(e.longitude=String(this.longitude))),void 0!==this.zoom&&(e.zoom=String(this.zoom)),this.soundpack&&(e.soundpack=this.soundpack),void 0!==this.demo&&(e.demo=String(this.demo)),this.title&&(e.title=this.title),void 0!==this.showVisualMap&&(e.showVisualMap=String(this.showVisualMap)),void 0!==this.heading&&(e.heading=String(this.heading)),void 0!==this.showHeading&&(e.showHeading=String(this.showHeading)),this.stepSize&&(e.stepsize=this.stepSize.toString()),this.additionalParams&&Object.entries(this.additionalParams).forEach(([t,s])=>{e[t]=String(s)}),e}toUrl(e=c.defaultBaseURL){const t=this.toQueryParams(),s=Object.entries(t).map(([e,t])=>`${e}=${t}`).join("&");return`${e}/embed/${this.embedId}?${s}`}toUrlWithBase(e){return this.toUrl(e)}}c.defaultBaseURL="https://audiom-staging.herokuapp.com";var d,h=n(686);!function(e){e.FEATURE="feature",e.MAP_IMAGE="map-image",e.CSV="csv",e.GEOJSON="geojson",e.GRAPHICS="graphics",e.GROUP="group",e.IMAGE="image",e.IMAGERY="imagery",e.IMAGERY_TILE="imagery-tile",e.MEDIA="media",e.OPEN_STREET_MAP="osm",e.RASTER="raster",e.STREAM="stream",e.TILE="tile",e.VECTOR_TILE="vector-tile",e.WEB_TILE="web-tile",e.WMS="wms",e.WMTS="wmts",e.UNKNOWN="unknown"}(d||(d={}));const m="Feature Layer",p="CSV Layer",g="GeoJSON Layer",f="Sublayer",y="No map view available",v="Processing layer:",M="Found FeatureLayer:",S="Found CSV layer:",w="Found GeoJSON layer:",E="Found sublayer:";function $(t,s){var i,r,n,a;h.MapViewManager.getInstance();const u=[];if(console.log("audiomConfigToEmbedConfig - useExistingMap:",t.useExistingMap),t.useExistingMap){const e=b(s).filter(e=>{var s;const i=null===(s=t.sourceConfigs)||void 0===s?void 0:s.find(t=>t.sourceUrl===e.url||t.source===e.source);return!i||!1!==i.enabled});u.push(...e)}else{const s=function(t){const s=(null==t?void 0:t.sourceConfigs)||[],i=[];return s.forEach(t=>{if(!1!==t.enabled&&(null==t?void 0:t.sourceUrl)){const s=o.fromEsri({name:t.name,source:t.source,url:t.sourceUrl,mapType:t.mapType||e.Indoor,rules:t.rulesFileUrl||""});i.push(s)}}),i}(t);u.push(...s)}return c.dynamic({apiKey:t.apiKey||"",sources:u,center:[t.centerLongitude||0,t.centerLatitude||0],showVisualMap:null===(i=t.showVisualMap)||void 0===i||i,showHeading:null!==(r=t.showHeading)&&void 0!==r&&r,zoom:null!==(n=t.zoom)&&void 0!==n?n:10,heading:t.heading,stepSize:l.Kilometers(null!==(a=t.stepSize)&&void 0!==a?a:1)})}function b(t){if(!t||!t.view)return console.warn(y),[];const s=[];return t.view.map.layers.forEach(t=>{const i=function(t){console.log(`${v} ${t.title} (type: ${t.type})`);let s=null;switch(t.type){case d.FEATURE:return s=function(t){if(!t||!t.url)return null;const s=o.fromEsri({name:t.title||m,source:t.id,url:`${t.url}/${t.layerId}`,mapType:e.Indoor});return console.log(`${M} ${t.title} - ${t.url}`),s}(t),s?[s]:[];case d.CSV:return s=function(e){if(!e||!e.url)return null;const t=o.fromGeoJsonUrl(e.url,e.title||p);return console.log(`${S} ${e.title} - ${e.url}`),t}(t),s?[s]:[];case d.GEOJSON:return s=function(e){if(!e||!e.url)return null;const t=o.fromGeoJsonUrl(e.url,e.title||g);return console.log(`${w} ${e.title} - ${e.url}`),t}(t),s?[s]:[];case d.MAP_IMAGE:return function(t){const s=[];if(!t||!t.sublayers)return s;return t.sublayers.forEach(i=>{if(!i.url)return;const r=o.fromEsri({name:i.title||f,source:`${t.id}_${i.id}`,url:i.url,mapType:e.Indoor});s.push(r),console.log(`${E} ${i.title} - ${i.url}`)}),s}(t);default:return[]}}(t);s.push(...i)}),console.log(`Extracted ${s.length} sources from map`),s}var T=n(972);r.DataSourceManager.getInstance().getDataSources();const I=e=>{var t,s;const[r,o]=(0,T.useState)(),n=$(e.config,r).toUrl((null===(t=e.config)||void 0===t?void 0:t.baseUrl)||"https://audiom-staging.herokuapp.com");return(0,i.jsxs)("div",{className:"jimu-widget",children:[e.useMapWidgetIds&&1===e.useMapWidgetIds.length&&(0,i.jsx)(h.JimuMapViewComponent,{useMapWidgetId:null===(s=e.useMapWidgetIds)||void 0===s?void 0:s[0],onActiveViewChange:e=>{e&&o(e)}}),(0,i.jsx)("iframe",{name:"audiom",src:n,width:"100%",height:"100%",title:"ESRI Map",style:{border:"0px"}})]})};function j(e){n.p=e}})(),a})())}}});