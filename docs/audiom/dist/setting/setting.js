System.register(["jimu-core/emotion","jimu-core","jimu-ui/advanced/setting-components","jimu-ui","jimu-arcgis"],function(e,t){var i={},n={},r={},s={},a={};return{setters:[function(e){i.Fragment=e.Fragment,i.jsx=e.jsx,i.jsxs=e.jsxs},function(e){n.React=e.React},function(e){r.MapWidgetSelector=e.MapWidgetSelector,r.SettingRow=e.SettingRow,r.SettingSection=e.SettingSection},function(e){s.Button=e.Button,s.Collapse=e.Collapse,s.Label=e.Label,s.NumericInput=e.NumericInput,s.Option=e.Option,s.Select=e.Select,s.Switch=e.Switch,s.TextInput=e.TextInput},function(e){a.MapViewManager=e.MapViewManager}],execute:function(){e((()=>{var e={244:e=>{"use strict";e.exports=n},298:e=>{"use strict";e.exports=r},321:e=>{"use strict";e.exports=s},386:e=>{"use strict";e.exports=i},686:e=>{"use strict";e.exports=a}},t={};function o(i){var n=t[i];if(void 0!==n)return n.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,o),r.exports}o.d=(e,t)=>{for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var l={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(l),o.d(l,{__set_webpack_public_path__:()=>G,default:()=>A});var e,t,i,n,r,s,a,u,c,d=o(386),p=o(244),h=o(298),m=o(321);!function(e){e.Travel="travel",e.Heatmap="heatmap",e.Indoor="indoor"}(e||(e={})),function(e){e.OSM="osm",e.TDEI="TDEI",e.ESRI="esri",e.GeoJSON="geojson"}(t||(t={}));class g{constructor(e){this.source=e.source,this.type=e.type,this.mapType=e.mapType,this.name=e.name,this.url=e.url,this.rules=e.rules,this.additionalParams=e.additionalParams}static fromName(e){return new g({source:e})}static fromGeoJsonUrl(e,i){return new g({source:e,type:t.GeoJSON,name:i})}static fromEsri(e){return new g({source:e.source,type:t.ESRI,url:e.url,name:e.name,mapType:e.mapType,rules:e.rules})}toQueryParams(){const e={};return this.type&&(e[`${this.source}.type`]=this.type),this.mapType&&(e[`${this.source}.mapType`]=this.mapType),this.name&&(e[`${this.source}.name`]=this.name),this.url&&(e[`${this.source}.url`]=this.url),this.rules&&(e[`${this.source}.rules`]=this.rules),this.additionalParams&&Object.entries(this.additionalParams).forEach(([t,i])=>{e[`${this.source}.${t}`]=String(i)}),e}}!function(e){e.Text="text",e.Number="number",e.Switch="switch",e.Enum="enum"}(i||(i={})),function(e){e.Default="default",e.Small="sm",e.Large="lg"}(n||(n={})),function(e){e.Primary="primary",e.Secondary="secondary",e.Tertiary="tertiary",e.Danger="danger",e.Link="link"}(r||(r={})),function(e){e.Wrap="wrap",e.NoWrap="no-wrap"}(s||(s={})),function(e){e.Key="key",e.Label="label",e.Type="type",e.Placeholder="placeholder",e.Min="min",e.Max="max",e.DefaultValue="defaultValue",e.ShowWhen="showWhen",e.EnumOptions="enumOptions"}(a||(a={})),function(e){e.Source="source",e.Name="name",e.SourceUrl="sourceUrl",e.RulesFileUrl="rulesFileUrl",e.MapType="mapType",e.Enabled="enabled"}(u||(u={})),function(e){e.ApiKey="apiKey",e.BaseUrl="baseUrl",e.Heading="heading",e.Title="title",e.StepSize="stepSize",e.ShowVisualMap="showVisualMap",e.ShowHeading="showHeading",e.SoundpackUrl="soundpackUrl",e.SourceConfigs="sourceConfigs",e.CenterLatitude="centerLatitude",e.CenterLongitude="centerLongitude",e.Zoom="zoom",e.UseExistingMap="useExistingMap",e.ExistingMapId="existingMapId"}(c||(c={}));const{useState:y}=p.React,f="Collapse",S="Expand",x="Remove",w="Enable",b="Disable",v=t=>{const{sourceConfigs:a,onChange:o,readOnly:l=!1}=t,[c,p]=y(!0),[g,v]=y({}),j=(e,t,i)=>{const n=[...a];n[e]=Object.assign(Object.assign({},n[e]),{[t]:i}),o(n)},M=[{key:u.Name,label:"Name",type:i.Text,placeholder:"Enter source display name"},{key:u.SourceUrl,label:"Source URL",type:i.Text,placeholder:"Enter map source URL"},{key:u.RulesFileUrl,label:"Rules File URL",type:i.Text,placeholder:"Enter rules file URL"},{key:u.Source,label:"Source",type:i.Text,placeholder:"Enter source identifier (e.g., units)"},{key:u.MapType,label:"Map Type",type:i.Enum,enumOptions:[{label:"Travel",value:e.Travel},{label:"Heatmap",value:e.Heatmap},{label:"Indoor",value:e.Indoor}],defaultValue:e.Indoor}];return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(h.SettingRow,{children:(0,d.jsxs)(m.Button,{size:n.Small,type:r.Tertiary,onClick:()=>p(!c),"aria-expanded":c,"aria-controls":"source-configs-panel","aria-label":`${c?f:S} Source Configurations section`,children:[(0,d.jsx)("span",{"aria-hidden":"true",children:c?"\u25bc":"\u25b6"})," ","Source Configurations"]})}),(0,d.jsxs)(m.Collapse,{isOpen:c,role:"region",children:[a.map((e,t)=>{const c=void 0===g[t]||g[t],p=(null==e?void 0:e.name)&&e.name.trim()?e.name:`Source ${t+1}`;return(0,d.jsxs)("div",{style:{marginBottom:"16px",padding:"12px",border:"1px solid #ccc",borderRadius:"4px"},children:[(0,d.jsxs)(h.SettingRow,{flow:s.Wrap,children:[(0,d.jsx)(m.Button,{size:n.Small,type:r.Tertiary,onClick:()=>(e=>{v(t=>Object.assign(Object.assign({},t),{[e]:void 0!==t[e]&&!t[e]}))})(t),"aria-expanded":c,"aria-label":`${c?f:S} ${p}`,style:{padding:"4px 8px"},children:(0,d.jsx)("span",{"aria-hidden":"true",children:c?"\u25bc":"\u25b6"})}),(0,d.jsx)(m.Label,{style:{flex:1,fontWeight:"bold",marginLeft:"8px"},children:p}),l?(0,d.jsx)(m.Button,{size:n.Small,type:!1===e.enabled?r.Primary:r.Secondary,onClick:()=>(e=>{var t;const i=[...a],n=null===(t=i[e].enabled)||void 0===t||t;i[e]=Object.assign(Object.assign({},i[e]),{enabled:!n}),o(i)})(t),"aria-label":`${!1===e.enabled?w:b} ${p}`,children:!1===e.enabled?w:b}):(0,d.jsx)(m.Button,{size:n.Small,type:r.Danger,onClick:()=>(e=>{const t=[...a];t.splice(e,1),o(t)})(t),"aria-label":`${x} ${p}`,children:x})]}),(0,d.jsx)(m.Collapse,{isOpen:c,children:M.map(e=>((e,t)=>{var n,r;const o=null!==(n=(a[t]||{})[e.key])&&void 0!==n?n:e.defaultValue,c=l&&e.key!==u.MapType&&e.key!==u.RulesFileUrl;switch(e.type){case i.Text:return(0,d.jsxs)(h.SettingRow,{flow:s.Wrap,children:[(0,d.jsx)(m.Label,{style:{width:"100%",marginBottom:"4px"},children:e.label}),(0,d.jsx)(m.TextInput,{style:{width:"100%"},value:o||"",onChange:i=>j(t,e.key,i.target.value),placeholder:e.placeholder,disabled:c})]},e.key);case i.Number:return(0,d.jsxs)(h.SettingRow,{flow:s.Wrap,children:[(0,d.jsx)(m.Label,{style:{width:"100%",marginBottom:"4px"},children:e.label}),(0,d.jsx)(m.NumericInput,{style:{width:"100%"},value:o,onChange:i=>j(t,e.key,i),min:e.min,max:e.max,disabled:c})]},e.key);case i.Switch:return(0,d.jsxs)(h.SettingRow,{flow:s.Wrap,children:[(0,d.jsx)(m.Label,{style:{width:"100%",marginBottom:"4px"},children:e.label}),(0,d.jsx)(m.Switch,{checked:o,onChange:i=>j(t,e.key,i.target.checked),disabled:c})]},e.key);case i.Enum:return(0,d.jsxs)(h.SettingRow,{flow:s.Wrap,children:[(0,d.jsx)(m.Label,{style:{width:"100%",marginBottom:"4px"},children:e.label}),(0,d.jsx)(m.Select,{style:{width:"100%"},value:o||e.defaultValue,onChange:i=>j(t,e.key,i.target.value),disabled:c,children:null===(r=e.enumOptions)||void 0===r?void 0:r.map(e=>(0,d.jsx)(m.Option,{value:e.value,children:e.label},e.value))})]},e.key)}})(e,t))})]},t)}),!l&&(0,d.jsx)(h.SettingRow,{children:(0,d.jsx)(m.Button,{size:n.Small,type:r.Primary,onClick:()=>{const e=[...a];e.push({}),o(e)},children:"Add Source Configuration"})})]})]})};var j,M=o(686);!function(e){e.Kilometers="km",e.Meters="m",e.Miles="mi",e.Feet="ft"}(j||(j={}));const k={[j.Meters]:1,[j.Kilometers]:1e3,[j.Miles]:1609.34,[j.Feet]:.3048};class E{constructor(e,t){if(e<=0)throw new Error("Step size value must be positive");this.value=e,this.unit=t}static Kilometers(e){return new E(e,j.Kilometers)}static Meters(e){return new E(e,j.Meters)}static Miles(e){return new E(e,j.Miles)}static Feet(e){return new E(e,j.Feet)}static parse(e){const t=e.match(/^(\d+(?:\.\d+)?)(km|m|mi|ft)?$/);if(!t)throw new Error(`Invalid step size format: ${e}`);const i=parseFloat(t[1]),n=t[2]||j.Meters;return new E(i,n)}toString(){return`${this.value}${this.unit}`}convertTo(e){if(this.unit===e)return new E(this.value,this.unit);const t=this.value*k[this.unit];return new E(t/k[e],e)}toMeters(){return this.convertTo(j.Meters)}toKilometers(){return this.convertTo(j.Kilometers)}toMiles(){return this.convertTo(j.Miles)}toFeet(){return this.convertTo(j.Feet)}}class T{constructor(e){this.embedId=e.embedId,this.apiKey=e.apiKey,e.sources&&(this.sources=e.sources.map(e=>"string"==typeof e?g.fromName(e):new g(e))),this.center=e.center,this.latitude=e.latitude,this.longitude=e.longitude,this.zoom=e.zoom,this.soundpack=e.soundpack,this.demo=e.demo,this.title=e.title,this.showVisualMap=e.showVisualMap,this.heading=e.heading,this.showHeading=e.showHeading,e.stepSize&&(this.stepSize="string"==typeof e.stepSize?E.parse(e.stepSize):e.stepSize),this.additionalParams=e.additionalParams}static dynamic(e){return new T(Object.assign(Object.assign({},e),{embedId:"dynamic"}))}static static(e,t,i){return new T(Object.assign({embedId:e,apiKey:t},i))}toQueryParams(){const e={};if(e.apiKey=this.apiKey,this.sources&&this.sources.length>0){const t=this.sources.map(e=>e.source).join(",");e["sources"]=t,this.sources.forEach(t=>{const i=t.toQueryParams();Object.assign(e,i)})}return this.center?e.center=`${this.center[0]},${this.center[1]}`:(void 0!==this.latitude&&(e.latitude=String(this.latitude)),void 0!==this.longitude&&(e.longitude=String(this.longitude))),void 0!==this.zoom&&(e.zoom=String(this.zoom)),this.soundpack&&(e.soundpack=this.soundpack),void 0!==this.demo&&(e.demo=String(this.demo)),this.title&&(e.title=this.title),void 0!==this.showVisualMap&&(e.showVisualMap=String(this.showVisualMap)),void 0!==this.heading&&(e.heading=String(this.heading)),void 0!==this.showHeading&&(e.showHeading=String(this.showHeading)),this.stepSize&&(e.stepsize=this.stepSize.toString()),this.additionalParams&&Object.entries(this.additionalParams).forEach(([t,i])=>{e[t]=String(i)}),e}toUrl(e=T.defaultBaseURL){const t=this.toQueryParams(),i=Object.entries(t).map(([e,t])=>`${e}=${t}`).join("&");return`${e}/embed/${this.embedId}?${i}`}toUrlWithBase(e){return this.toUrl(e)}}var C;T.defaultBaseURL="https://audiom-staging.herokuapp.com",function(e){e.FEATURE="feature",e.MAP_IMAGE="map-image",e.CSV="csv",e.GEOJSON="geojson",e.GRAPHICS="graphics",e.GROUP="group",e.IMAGE="image",e.IMAGERY="imagery",e.IMAGERY_TILE="imagery-tile",e.MEDIA="media",e.OPEN_STREET_MAP="osm",e.RASTER="raster",e.STREAM="stream",e.TILE="tile",e.VECTOR_TILE="vector-tile",e.WEB_TILE="web-tile",e.WMS="wms",e.WMTS="wmts",e.UNKNOWN="unknown"}(C||(C={}));const L="Feature Layer",I="CSV Layer",$="GeoJSON Layer",R="Sublayer",O="No map view available",U="Processing layer:",V="Found FeatureLayer:",z="Found CSV layer:",N="Found GeoJSON layer:",P="Found sublayer:";function W(t){if(!t||!t.view)return console.warn(O),[];const i=[];return t.view.map.layers.forEach(t=>{const n=function(t){console.log(`${U} ${t.title} (type: ${t.type})`);let i=null;switch(t.type){case C.FEATURE:return i=function(t){if(!t||!t.url)return null;const i=g.fromEsri({name:t.title||L,source:t.id,url:`${t.url}/${t.layerId}`,mapType:e.Indoor});return console.log(`${V} ${t.title} - ${t.url}`),i}(t),i?[i]:[];case C.CSV:return i=function(e){if(!e||!e.url)return null;const t=g.fromGeoJsonUrl(e.url,e.title||I);return console.log(`${z} ${e.title} - ${e.url}`),t}(t),i?[i]:[];case C.GEOJSON:return i=function(e){if(!e||!e.url)return null;const t=g.fromGeoJsonUrl(e.url,e.title||$);return console.log(`${N} ${e.title} - ${e.url}`),t}(t),i?[i]:[];case C.MAP_IMAGE:return function(t){const i=[];if(!t||!t.sublayers)return i;return t.sublayers.forEach(n=>{if(!n.url)return;const r=g.fromEsri({name:n.title||R,source:`${t.id}_${n.id}`,url:n.url,mapType:e.Indoor});i.push(r),console.log(`${P} ${n.title} - ${n.url}`)}),i}(t);default:return[]}}(t);i.push(...n)}),console.log(`Extracted ${i.length} sources from map`),i}function F(e,t){const i=function(e,t){var i;if(!t)return void console.warn("MapViewManager not provided");const n=null===(i=t.getJimuMapViewGroup(e))||void 0===i?void 0:i.jimuMapViews;if(n&&0!==Object.keys(n).length)return console.log(`Found ${Object.keys(n).length} JimuMapViews for map ID: ${e}`),Object.values(n)[0];console.warn(`${O} for map ID: ${e}`)}(e,t);if(!i||!i.view)return null;const n=i.view,r=n.center,s=n.zoom,a=W(i).map(e=>({name:e.name,source:e.source,sourceUrl:e.url,mapType:e.mapType,rulesFileUrl:e.rules,enabled:!0}));return{centerLatitude:r.latitude,centerLongitude:r.longitude,zoom:s,sourceConfigs:a.length>0?a:void 0}}const{useEffect:B}=p.React,A=e=>{var t,n;const{config:r}=e;B(()=>{if((null==r?void 0:r.useExistingMap)&&(null==r?void 0:r.existingMapId)){const t=M.MapViewManager.getInstance(),i=F(r.existingMapId,t);if(i){if(r.centerLatitude!==i.centerLatitude||r.centerLongitude!==i.centerLongitude||r.zoom!==i.zoom){let t=r.set(c.CenterLatitude,i.centerLatitude).set(c.CenterLongitude,i.centerLongitude).set(c.Zoom,i.zoom);i.sourceConfigs&&(t=t.set(c.SourceConfigs,i.sourceConfigs)),e.onSettingChange({id:e.id,config:t})}}}},[null==r?void 0:r.useExistingMap,null==r?void 0:r.existingMapId]);const a=(t,i)=>{e.onSettingChange({id:e.id,config:r.set(t,i)})},o=[{key:c.Title,label:"Title",type:i.Text,placeholder:"Enter widget title"},{key:c.ApiKey,label:"API Key",type:i.Text,placeholder:"Enter API key"},{key:c.BaseUrl,label:"Audiom Server Base URL",type:i.Text,placeholder:"Enter Audiom server URL"},{key:c.StepSize,label:"Step Size",type:i.Number,min:.1,defaultValue:1},{key:c.ShowVisualMap,label:"Show Visual Map",type:i.Switch,defaultValue:!0},{key:c.ShowHeading,label:"Show Heading",type:i.Switch,defaultValue:!1},{key:c.Heading,label:"Heading",type:i.Number,min:0,max:360,defaultValue:0},{key:c.SoundpackUrl,label:"Soundpack URL",type:i.Text,placeholder:"Enter soundpack URL"}],l=[{key:c.CenterLatitude,label:"Center Latitude",type:i.Number,defaultValue:0},{key:c.CenterLongitude,label:"Center Longitude",type:i.Number,defaultValue:0},{key:c.Zoom,label:"Zoom Level",type:i.Number,min:0,max:20,defaultValue:10}],u=(e,t=!1)=>{var n;const o=null!==(n=null==r?void 0:r[e.key])&&void 0!==n?n:e.defaultValue;switch(e.type){case i.Text:return(0,d.jsxs)(h.SettingRow,{flow:s.Wrap,children:[(0,d.jsx)(m.Label,{style:{width:"100%",marginBottom:"4px"},children:e.label}),(0,d.jsx)(m.TextInput,{style:{width:"100%"},value:o||"",onChange:t=>a(e.key,t.target.value),placeholder:e.placeholder,disabled:t})]},e.key);case i.Number:return(0,d.jsxs)(h.SettingRow,{flow:s.Wrap,children:[(0,d.jsx)(m.Label,{style:{width:"100%",marginBottom:"4px"},children:e.label}),(0,d.jsx)(m.NumericInput,{style:{width:"100%"},value:o,onChange:t=>a(e.key,t),min:e.min,max:e.max,disabled:t})]},e.key);case i.Switch:return(0,d.jsxs)(h.SettingRow,{flow:s.Wrap,children:[(0,d.jsx)(m.Label,{style:{width:"100%",marginBottom:"4px"},children:e.label}),(0,d.jsx)(m.Switch,{checked:o,onChange:t=>a(e.key,t.target.checked),disabled:t})]},e.key)}};return(0,d.jsxs)("div",{className:"widget-setting-demo",children:[(0,d.jsxs)(h.SettingSection,{title:"Map Source",children:[(0,d.jsxs)(h.SettingRow,{flow:s.Wrap,children:[(0,d.jsx)(m.Label,{style:{width:"100%",marginBottom:"4px"},children:"Use Existing Map Widget"}),(0,d.jsx)(m.Switch,{checked:null===(t=null==r?void 0:r.useExistingMap)||void 0===t||t,onChange:e=>a("useExistingMap",e.target.checked)})]}),(null==r?void 0:r.useExistingMap)?(0,d.jsxs)(h.SettingRow,{flow:s.Wrap,children:[(0,d.jsx)(m.Label,{style:{width:"100%",marginBottom:"4px"},children:"Select Map Widget"}),(0,d.jsx)(h.MapWidgetSelector,{useMapWidgetIds:e.useMapWidgetIds,onSelect:t=>{e.onSettingChange({id:e.id,useMapWidgetIds:t,config:r.set(c.ExistingMapId,t[0]||"")})}})]}):null,l.map(e=>{var t;return u(e,null===(t=null==r?void 0:r.useExistingMap)||void 0===t||t)}),(0,d.jsx)(v,{sourceConfigs:(null==r?void 0:r.sourceConfigs)||[],onChange:t=>{e.onSettingChange({id:e.id,config:r.set(c.SourceConfigs,t)})},readOnly:null===(n=null==r?void 0:r.useExistingMap)||void 0===n||n})]}),(0,d.jsx)(h.SettingSection,{title:"Configuration",children:o.map(e=>u(e,!1))})]})};function G(e){o.p=e}})(),l})())}}});