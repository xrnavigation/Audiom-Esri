System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-layouts/layout-runtime","jimu-theme"],function(e,t){var o={},s={},i={},n={},r={};return{setters:[function(e){o.jsx=e.jsx,o.jsxs=e.jsxs},function(e){s.BrowserSizeMode=e.BrowserSizeMode,s.CONSTANTS=e.CONSTANTS,s.DataSourceManager=e.DataSourceManager,s.ExpressionPartType=e.ExpressionPartType,s.ExpressionResolverComponent=e.ExpressionResolverComponent,s.ExpressionResolverErrorCode=e.ExpressionResolverErrorCode,s.Immutable=e.Immutable,s.LinkType=e.LinkType,s.MultipleDataSourceComponent=e.MultipleDataSourceComponent,s.React=e.React,s.ReactResizeDetector=e.ReactResizeDetector,s.classNames=e.classNames,s.css=e.css,s.getAppStore=e.getAppStore,s.hooks=e.hooks,s.withRepeatedDataSource=e.withRepeatedDataSource},function(e){i.Button=e.Button,i.CropType=e.CropType,i.Image=e.Image,i.ImageDots=e.ImageDots,i.ImageFillMode=e.ImageFillMode,i.ImageViewer=e.ImageViewer,i.Link=e.Link,i.Loading=e.Loading,i.LoadingType=e.LoadingType,i.defaultMessages=e.defaultMessages},function(e){n.utils=e.utils},function(e){r.styled=e.styled}],execute:function(){e((()=>{var e={1888:e=>{"use strict";e.exports=r},14321:e=>{"use strict";e.exports=i},37568:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.347 2.146a.485.485 0 0 1 0 .708L5.76 8l5.587 5.146a.486.486 0 0 1 0 .708.54.54 0 0 1-.738 0l-5.956-5.5a.485.485 0 0 1 0-.708l5.956-5.5a.54.54 0 0 1 .738 0" clip-rule="evenodd"></path></svg>'},41496:e=>{"use strict";e.exports=n},52943:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M4.653 13.854a.485.485 0 0 1 0-.708L10.24 8 4.653 2.854a.485.485 0 0 1 0-.708.54.54 0 0 1 .738 0l5.956 5.5a.485.485 0 0 1 0 .708l-5.956 5.5a.54.54 0 0 1-.738 0" clip-rule="evenodd"></path></svg>'},67386:e=>{"use strict";e.exports=o},73540:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M1 1v4h1V2h3V1zM15 1h-4v1h3v3h1zM1 15v-4h1v3h3v1zM15 15v-4h-1v3h-3v1z"></path><path fill="#000" fill-rule="evenodd" d="M4.182 10.546a4.5 4.5 0 0 0 5.991.334l2.14 2.14.708-.706-2.14-2.141a4.5 4.5 0 1 0-6.699.373m5.669-.72-.024.025a3.5 3.5 0 1 1 .024-.024" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=s}},t={};function a(o){var s=t[o];if(void 0!==s)return s.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,a),i.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.p="";var l={};return a.p=window.jimuConfig.baseUrl,(()=>{"use strict";a.r(l),a.d(l,{__set_webpack_public_path__:()=>W,default:()=>L});var e,t,o=a(67386),s=a(79244),i=a(14321),n=a(41496);!function(e){e.ByUpload="BYUPLOAD",e.ByStaticUrl="BYSTATICURL",e.ByDynamicUrl="BYDYNAMICURL"}(e||(e={})),function(e){e.Expression="EXPRESSION",e.Attachment="ATTACHMENT",e.Symbol="SYMBOL"}(t||(t={}));var r=function(e,t,o,s){return new(o||(o=Promise))(function(i,n){function r(e){try{l(s.next(e))}catch(e){n(e)}}function a(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,a)}l((s=s.apply(e,t||[])).next())})};const c=["image/png","image/jpeg","image/gif","image/bmp","image/svg+xml","image/webp"];class u extends s.React.PureComponent{constructor(e){super(e),this.resolveExpressions=e=>r(this,void 0,void 0,function*(){const t=e;let o=[];if(t&&t.attachmentInfos)o=t.attachmentInfos;else if(t&&t.queryAttachments)try{o=yield t.queryAttachments(c)}catch(e){console.error("Error querying attachments:",e)}this.props.onChange&&this.props.onChange(o)}),this.state={attachmentInfos:null}}componentDidMount(){this.resolveExpressions(this.props.record)}componentWillUnmount(){this.props.unmountAttachmentInfosChange&&this.props.unmountAttachmentInfosChange()}componentDidUpdate(e,t){var o,s,i,n;const r=(null===(o=this.props.record)||void 0===o?void 0:o.getId())===(null===(s=e.record)||void 0===s?void 0:s.getId()),a=(null===(i=this.props.record)||void 0===i?void 0:i.dataSource.id)===(null===(n=e.record)||void 0===n?void 0:n.dataSource.id);r&&a||this.resolveExpressions(this.props.record)}render(){return null}}class p extends s.React.PureComponent{constructor(e){super(e),this.isLoading=!1,this.resolveExpressions=e=>{if(e){const t=e;this.isLoading=!0,t&&t.fetchSymbolPreviewHTML&&t.fetchSymbolPreviewHTML().then(e=>{this.isLoading&&(this.isLoading=!1,this.setState({symbolElement:e}))},()=>{this.isLoading=!1})}else this.isLoading=!1,this.setState({symbolElement:null})},this.shallowEquals=(e,t)=>!e&&!t||!(!e||!t)&&(Object.keys(e).length===Object.keys(t).length&&!Object.keys(e).some(o=>e[o]!==t[o])),this.state={symbolElement:null}}componentDidMount(){this.resolveExpressions(this.props.record)}componentWillUnmount(){this.props.unmountSymbolElementChange&&this.props.unmountSymbolElementChange()}componentDidUpdate(e,t){this.shallowEquals(this.props.record,e.record)||this.resolveExpressions(this.props.record),t.symbolElement!==this.state.symbolElement&&this.props.onChange&&this.props.onChange(this.state.symbolElement)}render(){return null}}const d=e=>s.css`
    .image-symbol {
      display: grid;
      place-items: center;
      svg, img {
        transform: scale(${e});
      }
    }
  `,h=s.React.memo(e=>{const{record:t,toolTip:i,altText:n,symbolScale:r=1}=e,a=s.React.useRef(null),l=s.React.useCallback(e=>{var t;const o=["IMG","SVG"].includes(null==e?void 0:e.tagName)?e:null===(t=null==e?void 0:e.querySelector)||void 0===t?void 0:t.call(e,"svg,img");o&&o.setAttribute("alt",n),a.current&&(a.current.innerHTML="",e&&a.current.appendChild(e.cloneNode(!0)))},[n]),c=s.React.useCallback(()=>{a.current&&(a.current.innerHTML="")},[]);return(0,o.jsxs)(s.React.Fragment,{children:[(0,o.jsx)("div",{className:"w-100 h-100",css:d(r),children:(0,o.jsx)("div",{ref:a,className:"w-100 h-100 image-symbol",title:i})}),(0,o.jsx)(p,{record:t,unmountSymbolElementChange:c,onChange:l})]})});class g extends s.React.PureComponent{constructor(e){super(e),this.updateRecord=()=>{this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{const e=this.getSingleRecord(),t=null==e?void 0:e.dataSource.id,o=null==e?void 0:e.getId();!this.props.onRecordChange||this.previousDsId===t&&this.previousRecordId===o||this.props.onRecordChange(e),this.previousDsId=t,this.previousRecordId=o},50)},this.shallowEquals=(e,t)=>!e&&!t||!(!e||!t)&&(Object.keys(e).length===Object.keys(t).length&&!Object.keys(e).some(o=>e[o]!==t[o])),this.getSingleRecord=()=>{var e,t;if(this.props.isSelectedFromRepeatedDataSourceContext){const o=this.props.repeatedDataSource,s=Array.isArray(o)?null===(e=o[0])||void 0===e?void 0:e.record:null===(t=o)||void 0===t?void 0:t.record;return!s||s.fake?null:s}{if(!this.props.useDataSource)return null;const e=this.props.useDataSource.dataSourceId;if(e.split("-").reverse()[0]===s.CONSTANTS.SELECTION_DATA_VIEW_ID){const t=s.DataSourceManager.getInstance().getDataSource(e);let o=null==t?void 0:t.getRecords()[0];if(!o){const e=null==t?void 0:t.getMainDataSource().getDataView(s.CONSTANTS.DATA_VIEW_ID_FOR_NO_SELECTION);o=null==e?void 0:e.getRecords()[0]}return o}{const t=s.DataSourceManager.getInstance().getDataSource(e);return null==t?void 0:t.getRecords()[0]}}},this.onDataSourceCreated=e=>{if(e){const t={};Object.keys(e).forEach(o=>{o&&e[o]&&(t[o]=e[o].getInfo())}),this.setState({infos:t})}},this.onDataSourceInfoChange=e=>{this.setState({infos:e})},this.addDataViewForNoSelection=e=>{let t=(0,s.Immutable)([]);if(!e)return t;if(e.mainDataSourceId&&!t.some(t=>t.mainDataSourceId===e.mainDataSourceId)){const o=s.DataSourceManager.getInstance().getDataSource(e.mainDataSourceId),i=o&&o.getDataSourceJson();(null==i?void 0:i.dataViews)&&(null==i?void 0:i.dataViews[s.CONSTANTS.DATA_VIEW_ID_FOR_NO_SELECTION])&&(t=t.concat(e.set("dataSourceId",s.DataSourceManager.getInstance().getDataViewDataSourceId(e.mainDataSourceId,s.CONSTANTS.DATA_VIEW_ID_FOR_NO_SELECTION)).set("dataViewId",s.CONSTANTS.DATA_VIEW_ID_FOR_NO_SELECTION)))}return t.concat([e])},this.getQueries=e=>{const t={};return e?(e.forEach(e=>{t[e.dataSourceId]={}}),t):t},this.state={infos:null}}componentDidMount(){this.updateRecord()}componentWillUnmount(){this.timer&&(window.clearTimeout(this.timer),this.timer=null),this.props.onRecordChange(null)}componentDidUpdate(e,t){var o,s,i,n,r,a;this.props.isSelectedFromRepeatedDataSourceContext?this.props.repeatedDataSource===e.repeatedDataSource&&this.props.isSelectedFromRepeatedDataSourceContext===e.isSelectedFromRepeatedDataSourceContext&&(null===(i=null===(o=this.state.infos)||void 0===o?void 0:o[null===(s=this.props.useDataSource)||void 0===s?void 0:s.dataSourceId])||void 0===i?void 0:i.version)===(null===(a=null===(n=t.infos)||void 0===n?void 0:n[null===(r=this.props.useDataSource)||void 0===r?void 0:r.dataSourceId])||void 0===a?void 0:a.version)||this.updateRecord():this.props.useDataSource===e.useDataSource&&this.shallowEquals(this.state.infos,t.infos)||this.updateRecord()}render(){const e=this.addDataViewForNoSelection(this.props.useDataSource);return(0,o.jsx)(s.MultipleDataSourceComponent,{useDataSources:e,onDataSourceCreated:this.onDataSourceCreated,onDataSourceInfoChange:this.onDataSourceInfoChange,queries:this.getQueries(e),widgetId:this.props.widgetId})}}const m=(0,s.withRepeatedDataSource)(g);var v=a(37568),f=a.n(v),x=function(e,t){var o={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(o[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(o[s[i]]=e[s[i]])}return o};const S=e=>{const t=window.SVG,{className:i}=e,n=x(e,["className"]),r=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,o.jsx)(t,Object.assign({className:r,src:f()},n)):(0,o.jsx)("svg",Object.assign({className:r},n))};var y=a(52943),I=a.n(y),C=function(e,t){var o={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(o[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(o[s[i]]=e[s[i]])}return o};const E=e=>{const t=window.SVG,{className:i}=e,n=C(e,["className"]),r=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,o.jsx)(t,Object.assign({className:r,src:I()},n)):(0,o.jsx)("svg",Object.assign({className:r},n))},T={_widgetLabel:"Image",imageChooseShape:"Shape",imageCrop:"Crop",previousImage:"Previous image",nextImage:"Next image",imageViewer:"Image viewer"},b=e=>s.css`
    ${e?`height: ${e}px !important;`:""}
    .dots-nav {
      max-width: 100%;
      position: absolute;
      z-index: 1;
      bottom: 5%;
      left: 50%;
      transform: translateX(-50%);
    }
    .image-gallery-content {
      position: relative;
      overflow: hidden;
      .image-gallery-item {
        transition: all .3s ease;
        position: absolute;
        inset: 0;
        opacity: 0;
        z-index: -1;
      }
      .image-gallery-current {
        position: unset;
        opacity: 1;
      }
      .image-gallery-current.image-gallery-current-loading {
        opacity: 0;
      }
      .image-gallery-previous {
        filter: blur(3px);
      }
      .image-gallery-previous.image-gallery-current-loading {
        opacity: 1;
      }
    }
    .image-gallery-button {
      color: rgba(255, 255, 255, 0.8);
      svg {
        height: 32px;
        filter: drop-shadow(0 0 4px #000);
      }
      &:hover {
        color: rgba(255, 255, 255, 1);
        svg {
          filter: drop-shadow(0 0 6px #000);
        }
      }
    }
  `;class w extends s.React.PureComponent{constructor(e){super(e),this.backImg=e=>{const t=this.getPreviousIndex();this.setState(e=>{const o=[...e.statusArray];return o[t]||(o[t]="loading"),{currentIndex:t,oldIndex:e.currentIndex,statusArray:o,height:"loading"===o[t]?this.rootRef.current.clientHeight:null}}),null==e||e.preventDefault(),null==e||e.stopPropagation()},this.forwardImg=e=>{const t=this.getNextIndex();this.setState(e=>{const o=[...e.statusArray];return o[t]||(o[t]="loading"),{currentIndex:t,oldIndex:e.currentIndex,statusArray:o,height:"loading"===o[t]?this.rootRef.current.clientHeight:null}}),null==e||e.preventDefault(),null==e||e.stopPropagation()},this.setCurrentImg=e=>{this.state.currentIndex!==e&&this.setState(t=>{const o=[...t.statusArray];return o[e]||(o[e]="loading"),{currentIndex:e,oldIndex:t.currentIndex,statusArray:o,height:"loading"===o[e]?this.rootRef.current.clientHeight:null}})},this.handleLoad=e=>{this.setState(t=>{const o=[...t.statusArray];return o[e]="loaded",{statusArray:o,height:null}})},this.handleTouchStart=e=>{1===e.touches.length&&(this.touchStart={x:e.touches[0].clientX,y:e.touches[0].clientY})},this.handleTouchMove=e=>{if(1!==e.touches.length)return;this.touchMove={x:e.touches[0].clientX,y:e.touches[0].clientY};const t=this.touchMove.x-this.touchStart.x,o=this.touchMove.y-this.touchStart.y;Math.abs(t)>Math.abs(o)&&(null==e||e.preventDefault())},this.handleTouchEnd=e=>{const t=this.props.sources||[];if(void 0!==this.touchStart&&void 0!==this.touchMove&&t.length>1){const t=this.touchMove.x-this.touchStart.x,o=this.touchMove.y-this.touchStart.y;Math.abs(t)>Math.abs(o)&&(t<-50&&this.forwardImg(e),t>50&&this.backImg(e))}this.touchStart=void 0,this.touchMove=void 0},this.rootRef=s.React.createRef(),this.state={currentIndex:0,oldIndex:null,statusArray:["loading"],height:null}}componentDidMount(){this.rootRef.current.addEventListener("touchstart",this.handleTouchStart,{passive:!1}),this.rootRef.current.addEventListener("touchmove",this.handleTouchMove,{passive:!1}),this.rootRef.current.addEventListener("touchend",this.handleTouchEnd,{passive:!1})}componentWillUnmount(){this.rootRef.current.removeEventListener("touchstart",this.handleTouchStart),this.rootRef.current.removeEventListener("touchmove",this.handleTouchMove),this.rootRef.current.removeEventListener("touchend",this.handleTouchEnd)}componentDidUpdate(e,t){e.sources!==this.props.sources&&this.setState({currentIndex:0,oldIndex:null,statusArray:["loading"],height:null})}getPreviousIndex(){return this.state.currentIndex>0?this.state.currentIndex-1:this.props.sources.length-1}getNextIndex(){return this.state.currentIndex<this.props.sources.length-1?this.state.currentIndex+1:0}render(){const{intl:e,toolTipWithAttachmentName:t,title:n,altTextWithAttachmentName:r,alt:a,cropParam:l,imageFillMode:c,isAutoHeight:u,isAutoWidth:p,browserSizeMode:d}=this.props,h=this.props.sources||[],g=this.props.sources,{currentIndex:m,oldIndex:v,statusArray:f,height:x}=this.state,y=e.formatMessage({id:"previousImage",defaultMessage:T.previousImage}),I=e.formatMessage({id:"nextImage",defaultMessage:T.nextImage}),C="loading"===f[m]&&h.length>0,w=!g,R=d===s.BrowserSizeMode.Large;return(0,o.jsxs)("div",{ref:this.rootRef,className:"w-100 h-100",css:b(x),children:[h&&h.length>1&&R&&(0,o.jsxs)(s.React.Fragment,{children:[(0,o.jsx)(i.Button,{icon:!0,variant:"text",size:"sm",disableHoverEffect:!0,disableRipple:!0,className:"image-gallery-button",style:{padding:0,top:"50%",transform:"translateY(-50%)",position:"absolute",left:0,zIndex:1},"aria-label":y,onClick:this.backImg,children:(0,o.jsx)(S,{size:26})}),(0,o.jsx)(i.Button,{icon:!0,variant:"text",size:"sm",disableHoverEffect:!0,disableRipple:!0,className:"image-gallery-button",style:{padding:0,top:"50%",transform:"translateY(-50%)",position:"absolute",right:0,zIndex:1},"aria-label":I,onClick:this.forwardImg,children:(0,o.jsx)(E,{size:26})})]}),h&&h.length>1&&!R&&(0,o.jsx)(i.ImageDots,{className:"dots-nav",imageCount:h.length,currentIndex:m,onChange:this.setCurrentImg}),(0,o.jsxs)("div",{className:"image-gallery-content w-100 h-100",children:[(C||w)&&(0,o.jsx)(i.Loading,{type:i.LoadingType.Donut,width:16,height:16}),h.map((e,d)=>{const h=e.url,g=t?e.name:n,f=r?e.name:a,x=d===m,S=d===v;return(0,o.jsx)(i.Image,{className:(0,s.classNames)("image-gallery-item w-100 h-100",{"image-gallery-current":x,"image-gallery-previous":S,"image-gallery-current-loading":C}),src:h,fadeInOnLoad:!0,cropParam:l,imageFillMode:c,isAutoHeight:u,isAutoWidth:p,title:g,alt:f,showBrokenPlaceholder:!0,onLoad:()=>{this.handleLoad(d)}},e.id)}),g&&0===g.length&&(0,o.jsx)(i.Image,{src:"",fadeInOnLoad:!0,cropParam:l,imageFillMode:c,isAutoHeight:u,isAutoWidth:p})]})]})}}var R=a(1888),D=a(73540),j=a.n(D),A=function(e,t){var o={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(o[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(o[s[i]]=e[s[i]])}return o};const M=e=>{const t=window.SVG,{className:i}=e,n=A(e,["className"]),r=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?(0,o.jsx)(t,Object.assign({className:r,src:j()},n)):(0,o.jsx)("svg",Object.assign({className:r},n))},O=(0,R.styled)(i.Button)(s.css`
  position: absolute;
  z-index: 1;
  top: 8px;
  right: 8px;
  border-radius: 50%;
  border: none;
  opacity: .7;
  &:hover {
    opacity: 1;
  }
`),N=e=>{const{srcList:t=[],defaultIndex:n=0}=e,[r,a]=s.React.useState(!1),l=s.hooks.useTranslation(T,i.defaultMessages);return(0,o.jsxs)(s.React.Fragment,{children:[t.length>0&&(0,o.jsx)(O,{"aria-label":l("imageViewer"),disableHoverEffect:!0,icon:!0,variant:"contained",size:"sm",onClick:e=>{a(!0),e.stopPropagation()},children:(0,o.jsx)(M,{})}),(0,o.jsx)(i.ImageViewer,{srcList:t,defaultIndex:n,isOpen:r,onClose:()=>{a(!1)}})]})},k={};class P extends s.React.PureComponent{constructor(t){var o,i,n,r,a,l,c,u,p,d,h,g,m,v;super(t),this.__unmount=!1,this.widgetConRef=s.React.createRef(),this.checkIsStaticSrc=t=>t===e.ByUpload||t===e.ByStaticUrl||!t,this.getSrcExpression=()=>this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.srcExpression||(0,s.Immutable)({name:"",parts:[{type:s.ExpressionPartType.String,exp:`"${this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.imageParam&&this.props.config.functionConfig.imageParam.url}"`}]}),this.getAltTextExpression=()=>this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.altTextExpression||(0,s.Immutable)({name:"",parts:[{type:s.ExpressionPartType.String,exp:`"${this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.altText}"`}]}),this.getToolTipExpression=()=>this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.toolTipExpression||(0,s.Immutable)({name:"",parts:[{type:s.ExpressionPartType.String,exp:`"${this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.toolTip}"`}]}),this.getLinkUrlExpression=()=>this.props.config&&this.props.config.functionConfig&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam&&this.props.config.functionConfig.linkParam.expression||null,this.onSrcExpResolveChange=e=>{e.isSuccessful&&this.setState({src:"null"===e.value?"":e.value})},this.onToolTipExpResolveChange=e=>{if(e.isSuccessful)this.setState({toolTip:"null"===e.value?"":e.value});else{let t="";e.value===s.ExpressionResolverErrorCode.Failed&&(t=this.state.srcExpression&&this.state.srcExpression.name),this.setState({toolTip:t})}},this.onAltTextExpResolveChange=e=>{if(e.isSuccessful)this.setState({altText:"null"===e.value?"":e.value});else{let t="";e.value===s.ExpressionResolverErrorCode.Failed&&(t=this.state.srcExpression&&this.state.srcExpression.name),this.setState({altText:t})}},this.onLinkUrlExpResolveChange=e=>{if(e.isSuccessful)this.setState({linkUrl:e.value});else{let t="";e.value===s.ExpressionResolverErrorCode.Failed&&(t=this.state.srcExpression&&this.state.srcExpression.name),this.setState({linkUrl:t})}},this.onAttachmentInfosChange=e=>{this.setState({attachmentInfos:e})},this.unmountAttachmentInfosChange=()=>{this.setState({attachmentInfos:[]})},this.onClick=e=>{const t=this.props.config.functionConfig.linkParam;t&&t.value&&t.linkType!==s.LinkType.None&&(e.exbEventType="linkClick")},this.onCropWidgetResize=({width:e,height:t})=>{this.__unmount||(e||t)&&this.setState({cropWidgetWidth:e,cropWidgetHeight:t})},this.clearCropWidgetSize=()=>{this.setState({cropWidgetWidth:null,cropWidgetHeight:null})},this.handleRecordChange=e=>{this.setState({record:e,attachmentInfos:null})},this.state={record:null,toolTip:(null===(n=null===(i=null===(o=this.props)||void 0===o?void 0:o.config)||void 0===i?void 0:i.functionConfig)||void 0===n?void 0:n.toolTip)||"",altText:(null===(l=null===(a=null===(r=this.props)||void 0===r?void 0:r.config)||void 0===a?void 0:a.functionConfig)||void 0===l?void 0:l.altText)||"",src:(null===(d=null===(p=null===(u=null===(c=this.props)||void 0===c?void 0:c.config)||void 0===u?void 0:u.functionConfig)||void 0===p?void 0:p.imageParam)||void 0===d?void 0:d.url)||"",linkUrl:(null===(v=null===(m=null===(g=null===(h=this.props)||void 0===h?void 0:h.config)||void 0===g?void 0:g.functionConfig)||void 0===m?void 0:m.linkParam)||void 0===v?void 0:v.value)||"",srcExpression:this.props.useDataSourcesEnabled&&this.getSrcExpression(),altTextExpression:this.props.useDataSourcesEnabled&&this.getAltTextExpression(),toolTipExpression:this.props.useDataSourcesEnabled&&this.getToolTipExpression(),linkUrlExpression:this.props.useDataSourcesEnabled&&this.getLinkUrlExpression(),attachmentInfos:[],cropWidgetWidth:null,cropWidgetHeight:null}}getStyle(){var e;const{aspectRatio:t,useAspectRatio:o}=this.props,r=null===(e=this.props.config.functionConfig.imageParam)||void 0===e?void 0:e.cropParam,a=null==r?void 0:r.cropPixel,l=null==r?void 0:r.cropType,c=!a||!l||l===i.CropType.Real;return s.css`
      ${c&&o&&`img {\n        aspect-ratio: ${n.utils.parseAspectRatio(t)};\n      }`}
      .widget-image-link {
        display: block;
        padding: 0;
        border: none;
        width: 100%;
        height: 100%;
        outline-offset: -2px !important;
        border-radius: unset;
      }
    `}componentDidMount(){this.__unmount=!1}componentDidUpdate(o,s){var i,n,r,a,l,c,u,p,d,h,g,m,v,f,x,S,y,I;this.props.useDataSourcesEnabled||this.props.config===o.config&&!o.useDataSourcesEnabled||this.setState({src:(null===(a=null===(r=null===(n=null===(i=this.props)||void 0===i?void 0:i.config)||void 0===n?void 0:n.functionConfig)||void 0===r?void 0:r.imageParam)||void 0===a?void 0:a.url)||"",toolTip:null===(u=null===(c=null===(l=this.props)||void 0===l?void 0:l.config)||void 0===c?void 0:c.functionConfig)||void 0===u?void 0:u.toolTip,altText:null===(h=null===(d=null===(p=this.props)||void 0===p?void 0:p.config)||void 0===d?void 0:d.functionConfig)||void 0===h?void 0:h.altText,linkUrl:null===(f=null===(v=null===(m=null===(g=this.props)||void 0===g?void 0:g.config)||void 0===m?void 0:m.functionConfig)||void 0===v?void 0:v.linkParam)||void 0===f?void 0:f.value}),!this.props.useDataSourcesEnabled||this.props.config===o.config&&o.useDataSourcesEnabled||(this.checkIsStaticSrc(this.props.config.functionConfig.imgSourceType)?this.setState({src:(null===(I=null===(y=null===(S=null===(x=this.props)||void 0===x?void 0:x.config)||void 0===S?void 0:S.functionConfig)||void 0===y?void 0:y.imageParam)||void 0===I?void 0:I.url)||"",toolTipExpression:this.getToolTipExpression(),altTextExpression:this.getAltTextExpression(),linkUrlExpression:this.getLinkUrlExpression()}):this.props.config.functionConfig.imgSourceType!==e.ByDynamicUrl||this.props.config.functionConfig.dynamicUrlType&&this.props.config.functionConfig.dynamicUrlType!==t.Expression?this.setState({src:"",toolTipExpression:this.getToolTipExpression(),altTextExpression:this.getAltTextExpression(),linkUrlExpression:this.getLinkUrlExpression()}):this.setState({record:null,srcExpression:this.getSrcExpression(),toolTipExpression:this.getToolTipExpression(),altTextExpression:this.getAltTextExpression(),linkUrlExpression:this.getLinkUrlExpression()}))}componentWillUnmount(){this.__unmount=!0;(0,s.getAppStore)().getState().appConfig.widgets[this.props.id]||delete k[this.props.id+"-"+this.props.layoutId]}render(){const{id:n,useDataSourcesEnabled:r,useDataSources:a,config:l,autoHeight:c,autoWidth:p,isInlineEditing:d,repeatedDataSource:g,builderSupportModules:v,queryObject:f,browserSizeMode:x,intl:S}=this.props,{functionConfig:y={}}=l,{dynamicUrlType:I,imageFillMode:C,imageDisplayQualityMode:E,altTextWithAttachmentName:T,toolTipWithAttachmentName:b,symbolScale:R,linkParam:D,imgSourceType:j,imageViewer:A,useDataSourceForMainDataAndViewSelector:M,isSelectedFromRepeatedDataSourceContext:O,imageParam:k,srcExpression:P}=y,{toolTip:L,altText:W,src:_,record:U,attachmentInfos:F,linkUrl:z,cropWidgetWidth:B,cropWidgetHeight:V,linkUrlExpression:H}=this.state;let q=null,Y=null;const{originalWidth:$,fileFormat:G,cropParam:X}=k||{},Q=j===e.ByDynamicUrl,J=I===t.Attachment&&r,K=I===t.Symbol&&r,Z=Q&&(!I||I===t.Expression)&&r,ee=J||K,te=!ee;let oe,se,ie=[];if(J?ie=F&&F.length>0?F.map(e=>e.url):[""]:K||(ie=[_]),Y=(0,o.jsxs)(s.React.Fragment,{children:[te&&(0,o.jsx)(i.Image,{src:_,title:L,alt:W,fadeInOnLoad:!0,imageFillMode:C,isAutoHeight:c,isAutoWidth:p,quality:E,originalWidth:$,fileFormat:G,cropParam:X,showBrokenPlaceholder:!0,className:(0,s.classNames)({"d-none":P&&!_})}),J&&(0,o.jsx)("div",{className:"w-100 h-100",children:(0,o.jsx)(w,{sources:F,cropParam:null==k?void 0:k.cropParam,imageFillMode:C,isAutoHeight:c,isAutoWidth:p,title:L,alt:W,altTextWithAttachmentName:T,toolTipWithAttachmentName:b,intl:S,browserSizeMode:x})}),K&&(0,o.jsx)(h,{record:U,toolTip:L,altText:W,symbolScale:R})]}),D&&D.linkType&&(oe=D.openType,se={linkType:D.linkType},D.linkType===s.LinkType.WebAddress?se.value=z:se.value=D.value),q=se&&(null==se?void 0:se.linkType)!==s.LinkType.None?(0,o.jsx)(i.Link,{to:se,target:oe,queryObject:f,className:"widget-image-link",unstyled:!0,children:Y}):Y,C!==i.ImageFillMode.Fit&&d&&_&&(!g||g&&0===g.recordIndex)){const e=v.widgetModules.WidgetInBuilder;q=(0,o.jsxs)("div",{className:"widget-image w-100 h-100",ref:this.widgetConRef,css:this.getStyle(),children:[(0,o.jsx)(s.ReactResizeDetector,{targetRef:this.widgetConRef,handleWidth:!0,handleHeight:!0,onResize:this.onCropWidgetResize}),q,V&&B&&(0,o.jsx)(e,{widgetId:n,config:l,onUnmount:()=>{this.clearCropWidgetSize()},widgetWidth:B,widgetHeight:V})]})}else q=(0,o.jsxs)("div",{className:"widget-image w-100 h-100",ref:this.widgetConRef,css:this.getStyle(),onClick:e=>{this.onClick(e)},onTouchEnd:e=>{this.onClick(e)},children:[q,Z&&(0,o.jsx)(s.ExpressionResolverComponent,{useDataSources:a,expression:this.getSrcExpression(),onChange:this.onSrcExpResolveChange,widgetId:n}),r&&(0,o.jsxs)(s.React.Fragment,{children:[(0,o.jsx)(s.ExpressionResolverComponent,{useDataSources:a,expression:this.getAltTextExpression(),onChange:this.onAltTextExpResolveChange,widgetId:n}),(0,o.jsx)(s.ExpressionResolverComponent,{useDataSources:a,expression:this.getToolTipExpression(),onChange:this.onToolTipExpResolveChange,widgetId:n}),(0,o.jsx)(s.ExpressionResolverComponent,{useDataSources:a,expression:H,onChange:this.onLinkUrlExpResolveChange,widgetId:n})]}),J&&(0,o.jsx)(u,{record:U,unmountAttachmentInfosChange:this.unmountAttachmentInfosChange,onChange:this.onAttachmentInfosChange}),ee&&(0,o.jsx)(m,{widgetId:n,useDataSource:M,isSelectedFromRepeatedDataSourceContext:O,onRecordChange:this.handleRecordChange}),A&&ie.length>0&&(0,o.jsx)(N,{srcList:ie})]});return q}}P.mapExtraStateProps=(e,t)=>{var o,s;const i=e.appConfig,{layouts:n}=i,{layoutId:r,layoutItemId:a}=t,l=n[r],c=(null===(s=null===(o=null==l?void 0:l.content)||void 0===o?void 0:o[a])||void 0===s?void 0:s.setting)||{};return{useAspectRatio:"ratio"===c.heightMode&&null!=c.aspectRatio,aspectRatio:c.aspectRatio,queryObject:e.queryObject,browserSizeMode:e.browserSizeMode}};const L=P;function W(e){a.p=e}})(),l})())}}});