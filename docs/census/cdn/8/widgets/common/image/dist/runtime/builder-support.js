System.register(["jimu-core/emotion","jimu-core","jimu-for-builder","jimu-ui","jimu-ui/basic/imagecrop"],function(t,i){var e={},o={},n={},r={},s={};return{setters:[function(t){e.jsx=t.jsx,e.jsxs=t.jsxs},function(t){o.Immutable=t.Immutable,o.React=t.React,o.ReactDOM=t.ReactDOM,o.appActions=t.appActions,o.appConfigUtils=t.appConfigUtils,o.getAppStore=t.getAppStore},function(t){n.getAppConfigAction=t.getAppConfigAction},function(t){r.CropType=t.CropType},function(t){s.ImageCrop=t.ImageCrop}],execute:function(){t((()=>{var t={4108:t=>{"use strict";t.exports=n},14321:t=>{"use strict";t.exports=r},44456:t=>{"use strict";t.exports=s},67386:t=>{"use strict";t.exports=e},79244:t=>{"use strict";t.exports=o}},i={};function p(e){var o=i[e];if(void 0!==o)return o.exports;var n=i[e]={exports:{}};return t[e](n,n.exports,p),n.exports}p.d=(t,i)=>{for(var e in i)p.o(i,e)&&!p.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:i[e]})},p.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),p.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},p.p="";var a={};return p.p=window.jimuConfig.baseUrl,(()=>{"use strict";p.r(a),p.d(a,{default:()=>s});var t=p(67386),i=p(79244),e=p(4108),o=p(14321),n=p(44456);class r extends i.React.PureComponent{constructor(t){super(t),this.__unmount=!1,this.preloadImage=t=>{this.imgObject=new Image,this.imgObject.src=t,this.imgObject.onload=t=>{this.imgObject&&(this.__unmount||this.setState({imageWidth:this.imgObject.width,imageHeight:this.imgObject.height}))}},this.getCropZoomInCropTool=(t,i,e,o,n)=>{const r=t&&t.cropPixel,s=t&&t.cropZoom;let p=null,a=null,g=null,c=null;if(r&&s){const t=r.width,a=r.height;let m=null;i/e>=o/n?(g=i,c=n/o*g,i/e>=t/a?(m=i/(t*s),p=n*s*m/c):(m=e/(a*s),p=n*s*m/c)):(c=e,g=o/n*c,i/e>=t/a?(m=i/(t*s),p=n*s*m/c):(m=e/(a*s),p=n*s*m/c))}else i/e>=o/n?(g=i,c=n/o*g):(c=e,g=o/n*c),p=1;return a=g*p/o,a},this.getCropPositionInCropTool=(t,i)=>{const e=t&&t.cropPosition;return e?{x:i*e.x/t.cropZoom,y:i*e.y/t.cropZoom}:{x:0,y:0}},this.onCancelCrop=()=>{(0,i.getAppStore)().dispatch(i.appActions.setWidgetIsInlineEditingState(this.props.widgetId,!1))},this.onConfirmCrop=(t,n)=>{let r=this.props.config.functionConfig.imageParam;if(t.cropType===o.CropType.Real&&n&&(r=r.set("url",n.blobUrl).set("fileFormat",n.fileFormat)),r=r.set("cropParam",t),t.cropPixel){(0,i.getAppStore)().dispatch(i.appActions.setWidgetIsInlineEditingState(this.props.widgetId,!1));let t=(0,i.Immutable)(this.props.config.functionConfig);t=t.set("isCropped",!0),t=t.set("imageParam",r),(0,e.getAppConfigAction)().editWidgetConfig(this.props.widgetId,this.props.config.set("functionConfig",t)).exec()}},this.state={imageWidth:null,imageHeight:null,clientRect:{width:this.props.widgetWidth||0,height:this.props.widgetHeight||0,x:0,y:0,bottom:0,left:0,right:0,top:0,toJSON:()=>null}}}componentDidMount(){this.__unmount=!1;const t=i.appConfigUtils.processResourceUrl(this.props.config.functionConfig.imageParam.originalUrl);this.preloadImage(t);const e=document.querySelector(`.widget-renderer[data-widgetid='${this.props.widgetId}']`);e&&this.setState({clientRect:e.getBoundingClientRect()})}componentWillUnmount(){this.__unmount=!0,this.props.onUnmount&&this.props.onUnmount()}render(){const e=this.props.config.functionConfig.imageParam&&this.props.config.functionConfig.imageParam.cropParam,r=this.props.widgetWidth,s=this.props.widgetHeight;if(this.state.imageWidth&&this.state.imageHeight){const p=this.getCropZoomInCropTool(e,r,s,this.state.imageWidth,this.state.imageHeight),a=this.getCropPositionInCropTool(e,p),g=i.appConfigUtils.processResourceUrl(this.props.config.functionConfig.imageParam.originalUrl);return(0,t.jsx)(n.ImageCrop,{crop:a,cropZoom:p,imageFormat:this.props.config.functionConfig.imageParam.fileFormat,onCancelCrop:this.onCancelCrop,widgetArea:this.state.clientRect,cropParam:e,originId:this.props.config.functionConfig.imageParam.originalId,widgetId:this.props.widgetId,image:g,onConfirmCrop:this.onConfirmCrop,cropType:"BY_URL"===this.props.config.functionConfig.imageParam.imgSourceType?o.CropType.Fake:null})}return i.ReactDOM.createPortal((0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"jimu-widget",style:{zIndex:9999,position:"fixed",top:0,left:0,backgroundColor:"rgb(0, 0, 0, .5)"}}),(0,t.jsx)("div",{style:{position:"absolute",left:"50%",top:"50%",zIndex:9999},className:"jimu-secondary-loading"})]}),document&&document.getElementsByTagName("body")[0])}}const s={WidgetInBuilder:r}})(),a})())}}});