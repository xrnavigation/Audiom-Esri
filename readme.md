# ArcGIS Experience Builder - Docker Setup

Automated Docker environment for running ArcGIS Experience Builder with custom extension preservation.

## Features

- **Automated Setup**: Python scripts handle downloading and extracting specific ExB versions
- **Custom Extension Preservation**: Maintains your custom extensions and public files during updates
- **Docker Environment**: Containerized setup with proper Node.js version management
- **Version Flexibility**: Easy switching between ExB versions

## Prerequisites

- Python 3.11+ (for setup scripts)
- Docker and Docker Compose
- (If runnning locally) The [appropriate version](https://developers.arcgis.com/experience-builder/guide/release-versions/) of NodeJS.

## Quick Start

### Option 1: Run ArcGIS Experience Builder Locally

Download and extract a specific version (default: 1.19):

```bash
python utils/setup_arcgis.py
```

Or specify a version:

```bash
python utils/setup_arcgis.py 1.14
```

Then run the client and the server separately.

```bash
# Run the server.
cd ./ArcGIS/server
npm ci
npm start -- --port 3000 --https_port 3001
```

```bash
# Run the client.
cd ./ArcGIS/client
npm ci
npm start
```

### Option 2: Run with Docker

```bash
docker-compose up --build
```

The application will be available at:
- Client: http://localhost:3001
- Server: http://localhost:3000

## Project Structure

```
.
├── ArcGIS/                          # Generated by setup script
│   ├── client/
│   │   └── your-extensions/         # Preserved during updates
│   └── server/
│       └── public/                  # Preserved during updates
├── utils/
│   ├── setup_arcgis.py              # Main setup script
│   ├── download-arcgis.py           # Download utility
│   ├── exb-versions.py              # Version info utility
│   └── get-node-version.py          # Node version checker
├── compose.yaml                     # Docker Compose configuration
├── Dockerfile                       # Multi-stage Docker build
└── entrypoint.sh                    # Container startup script
```

## Setup Script Usage

The `setup_arcgis.py` script supports several commands:

```bash
# Download and setup (uses default version 1.19)
python utils/setup_arcgis.py

# Download specific version
python utils/setup_arcgis.py 1.14

# Clean directory while preserving custom folders
python utils/setup_arcgis.py clean

# Show help
python utils/setup_arcgis.py --help
```

### Preserved Folders

During setup or cleanup, these folders are automatically preserved:
- `client/your-extensions` - Your custom ExB extensions
- `server/public` - Public server files

## Configuration

### Docker Compose Environment Variables

Edit `compose.yaml` or create a `.env` file:

```env
EXB_VERSION=1.19
NODE_VERSION=22
```

## Utilities

### Check Available Versions
```bash
python utils/exb-versions.py
```

### Get Required Node Version
```bash
python utils/exb_versions.py 1.19 --node-version
```

### Download Only (without extraction)
```bash
python utils/download-arcgis.py 1.19
```

## Development

The Docker setup uses volume mounts for custom extensions and public files, allowing live development:

```yaml
volumes:
  - ./ArcGIS/client/your-extensions:/ArcGIS/client/your-extensions
  - ./ArcGIS/server/public:/ArcGIS/server/public
```

